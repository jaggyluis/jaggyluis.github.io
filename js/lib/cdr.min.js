/*! cdr 2016-11-29 */
function Interval(a,b){this.start=a,this.end=b}function Matrix3d(a,b,c){this.d=[],this.m=c,this.r=a,this.c=b,this._rs=[];var d,e,f,g;for(f=0;f<a;f++){for(d=[],g=0;g<b;g++)e=[],d.push(e);this.d.push(d),this._rs.push([])}}cdr={},cdr.version="0.0.1",cdr.class={},cdr.core={},cdr.core.file={readFile:function(a,b){function c(a,b){var c=new XMLHttpRequest;c.responseType="blob",c.open("GET",a,!0),c.onreadystatechange=function(){if(4===c.readyState&&(200===c.status||0===c.status)){var a=c.response;b(a)}},c.send(null)}var d=new FileReader;d.onprogress=cdr.core.file.updateProgress,d.onabort=cdr.core.file.abortUpload,d.onerror=cdr.core.file.errorHandler,d.onloadend=function(a){b(cdr.core.file.onSuccess(a))},c(a,function(a){d.readAsText(a)})},abortUpload:function(){console.log("Aborted read!")},errorHandler:function(a){switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:alert("File Not Found!");break;case a.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case a.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}},updateProgress:function(a){console.log("progress"),console.log(Math.round(a.loaded/a.total*100))},onSuccess:function(a){var b=a.target;return b.error?console.log("error onloadend!?"):b.result}},cdr.core.event={eventFire:function(a,b,c){if(a.fireEvent)a.fireEvent("on"+b);else{var d=document.createEvent("Events");d.initEvent(b,!0,!1),a.dispatchEvent(d),c&&d.stopPropagation()}}},cdr.core.math={round:function(a,b){return Math.round(a/b)*b},floor:function(a,b){return Math.floor(a/b)*b},remap:function(a,b,c,d){if(d=d||!1,0===b.getLength())return b.min;var e=(a-b.min)*c.getRange()/b.getRange()+c.min;return d?e>c.max?c.max:e<c.min?c.min:e:void 0},getRandomBinaryWithProbablity:function(a){return Math.random()>=1-a?1:0},getRandomArbitrary:function(a){return Math.random()*(a[1]-a[0])+a[0]},getRandomWeibull:function(a,b){return a=a||.5,b=b||3,a*Math.pow(-Math.log(Math.random()),1/b)}},cdr.core.obj={isNull:function(a){var b=!0;for(var c in a)null!==a[c]&&(b=!1);return b},parse:function(a){return Object.keys(a).reduce(function(b,c){return Number(a[c])?b[c]=Number(a[c]):a[c].toLowerCase().match(/false|true/)?b[c]=!a[c].toLowerCase().match(/false/):0===a[c].length?b[c]=null:b[c]=a[c],b},{})},pprint:function(a){function b(a,c){var d=c+"\t",e="";if(a instanceof array)a.forEach(function(a){e+="\r\n"+d+b(a,d)}.bind(this));else if(a instanceof Object)for(var f in a)e+="\r\n"+d+f,e+=b(a[f],d);else e+="\t"+a;return e}return b(a,"")}},cdr.core.csv={parse:function(a){var b=a.split("\n"),c=/[^\w\:\-]/gi,d=b[0].split(",").map(function(a){return a.replace(c,"")});return b.slice(1).map(function(a){var b={};return a.split(",").map(function(a){return a.replace(c,"")}).forEach(function(a,c){b[d[c]]=a}),b})},serialize:function(a,b){return a.reduce(function(a,c){return a+(b.map(function(a){return'"'+c[a]+'"'}).join(",")+"\n")},b.join(",")+"\n")}},cdr.core.array={filterStrict:function(a,b){var c=b.split(/[^\w\.]/);return a.filter(function(a){return c.every(function(b){return JSON.stringify(a).match(b)})})},filterLoose:function(a,b){var c=b.split(/[^\w\.]/);return a.filter(function(a){return c.some(function(b){return JSON.stringify(a).match(b)})})},getBestMatch:function(a,b){var c=b.split(/[^\w\.]/);return a?a.sort(function(a,b){var d=0,e=0;return c.forEach(function(c){JSON.stringify(a).match(c)&&d++,JSON.stringify(b).match(c)&&e++}),e-d})[0]:a},mode:function(a){for(var b=a[0],c={},d=0;d<a.length;d++)c[a[d]]?c[a[d]]++:c[a[d]]=1,c[a[d]]>c[b]&&(b=a[d]);return b},mapElementsToObjByPercentile:function(a,b){for(var c=a.length,d={},e=0;e<a.length;e++)d[a[e]]?d[a[e]]++:d[a[e]]=1;for(var f in d)d[f]=Math.round(d[f]/c*100),0===d[f]&&b&&delete d[f];return d},mapElementsToObjByKey:function(a,b){var c={};return a.forEach(function(a){null!==a[b]&&void 0!==a[b]&&(a[b]in c?c[a[b]].push(a):c[a[b]]=[a])}),c},hasAllMatchingElementsByKeys:function(a,b,c){return a.forEach(function(a,d){parr.forEach(function(e,f){if(d!==f&&(a[b]!==e[b]||a[c]!==e[c]))return!1})}),!0},shuffle:function(a){for(var b=a.length;b>0;){var c=Math.floor(Math.random()*b);b--;var d=a[b];a[b]=a[c],a[c]=d}return a}},cdr.core.string={generateUUID:function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}},cdr.core.time={toDecimalDay:function(a){return this.isapTime(a)?this.apTimeToDecimalDay(a):this.isTime(a)?this.timeToDecimalDay(a):isNaN(a)?null:a},decimalDayToTime:function(a){a=a>=0?a:1+a;var b=Number((24*a).toString().split(".")[0]),c=Number((24*a*60-60*b).toString().split(".")[0]),d=Number((24*a*60*60-60*b*60-60*c).toString().split(".")[0]);return b=b>0?b.toString():"00",c=c>0?c.toString():"00",d=d>0?d.toString():"00",b=b.length>1?b:"0"+b,c=c.length>1?c:"0"+c,d=d.length>1?d:"0"+d,b+":"+c+":"+d},decimalDayToMinutes:function(a){return a=a>=0?a:1+a,Number((24*a*60).toString().split(".")[0])},decimalDayDelta:function(a,b){return b-a<0?b-a+1:b-a},timeToDecimalDay:function(a){var b=a.split(":").map(function(a){return Number(a)});return this.minutesToDecimalDay(60*b[0]+b[1])},minutesToDecimalDay:function(a){return a/60/24},secondsToDecimalDay:function(a){return a/60/60/24},apTimeToDecimalDay:function(a){var b=a.split(/[:]/),c="AM"===b[2]?b[0]:"PM"===b[2]?(Number(b[0])+12).toString():b[2],d=b[1];return this.timeToDecimalDay(c+":"+d)},isTime:function(a){return null!==a.toString().match(/\d{1,2}:\d{2}(?!\D)/)},isapTime:function(a){return a.toString().toLowerCase().match(/am|pm/)},isPre9AM:function(a){return this.toDecimalDay(a)<.375},romanToNumber:function(a){var b={I:1,II:2,III:3,IV:4,V:5,VI:6};return void 0!==b[a]?b[a]:3},romanToLetter:function(a){var b={I:"A",II:"B",III:"C",IV:"D",V:"E",VI:"F"};return void 0!==b[a]?b[a]:"C"}},cdr.class.Interval=function(a,b){return new Interval(a,b)},cdr.class.Interval.deserialize=function(a){return Object.create(Interval.prototype,{start:{value:a.start},end:{value:a.end}})},cdr.class.Interval.interpolateRandom=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},Interval.prototype={},Interval.prototype.__defineGetter__("min",function(){return this.start<this.end?this.start:this.end}),Interval.prototype.__defineGetter__("max",function(){return this.start>this.end?this.start:this.end}),Interval.prototype.intersects=function(a){return this.includes(a.start)||this.includes(a.end)||a.includes(this.start)||a.includes(this.end)},Interval.prototype.getLength=function(){return this.end-this.start},Interval.prototype.contains=function(a){return this.includes(a.start)&&this.includes(a.end)},Interval.prototype.includes=function(a){return a>=this.start&&a<=this.end},Interval.prototype.padded=function(a,b){return a&&b?new Interval(this.start-a,this.end+b):a?new Interval(this.start-a,this.end+a):this},Interval.prototype.serialize=function(a){return{class:"Interval",data:{start:this.start,end:this.end}}},cdr.class.Matrix3d=function(a,b,c){return new Matrix3d(a,b,c)},cdr.class.Matrix3d.deserialize=function(a){return Object.create(Matrix3d.prototype,{d:{value:null},m:{value:a.m},r:{value:a.r},c:{value:a.c},_rs:{value:a._rs}})},Matrix3d.prototype={},Matrix3d.prototype.forEachItem=function(a){var b,c,d;for(b=0;b<this.d.length;b++)for(c=0;c<this.c;c++)for(d=0,len=this.d[b][c].length;d<len;d++)a(this.d[b][c][d],len,d,c,b)},Matrix3d.prototype.setItem=function(a,b,c,d){this.d[b][c][d]=a},Matrix3d.prototype.getItem=function(a,b,c){return this.d[a][b][c]||null},Matrix3d.prototype.pushItem=function(a,b,c){b===-1&&(b=this.d.length-1),c===-1&&(c=this.d[b].length-1),this.d[b][c].push(a)},Matrix3d.prototype.spliceItem=function(a,b,c,d){return void 0===this.d[c]?null:void 0===this.d[c][d]?null:void this.d[c][d].splice(b,0,a)},Matrix3d.prototype.unShiftItem=function(a,b,c){b===-1&&(b=this.d.length-1),c===-1&&(c=this.d[b].length-1),this.d[b][c].unshift(a)},Matrix3d.prototype.getCol=function(a,b){return this.d[a][b]||null},Matrix3d.prototype.getRow=function(a){return a===-1&&(a=this.d.length-1),this.d[a]||null},Matrix3d.prototype.getRowItemCount=function(a){return this.d[a].reduce(function(a,b){return a+b.length},0)},Matrix3d.prototype.getRowBlank=function(){for(var a=[],b=0;b<this.c;b++)a.push([]);return a},Matrix3d.prototype.setRow=function(a,b){this.d[b]=a},Matrix3d.prototype.copyRow=function(a,b,c){c===!0?this.insertRow(b,this.d[a]):this.d[b]=this.d[a].slice()},Matrix3d.prototype.shiftRow=function(a,b){var c;if(b>0)for(c=0;c<b;c++)this.d[a].push(this.d[a].shift()),this._rs[a].push(-b);else if(b<0)for(c=0;c<-b;c++)this.d[a].unshift(this.d[a].pop()),this._rs[a].push(-b)},Matrix3d.prototype.sortRow=function(a,b){this.d[a].sort(b)},Matrix3d.prototype.sortRowCols=function(a,b){for(var c=0;c<this.d[a].length;c++)this.sortRowCol(a,c,b)},Matrix3d.prototype.sortRowCol=function(a,b,c){this.d[a][b].sort(c)},Matrix3d.prototype.copyRowApply=function(a,b,c,d){var e,f,g,h,i,j,k=this.getRowBlank();for(i=0;i<this.d[a].length;i++)for(j=0;j<this.d[a][i].length;j++)f=this.d[a][i][j],g=this.d[a][i].length,h=d(f,this,g,j,i,a),void 0!==h&&(e=h<this.c?k[h]:k[h-this.c],e.push(f));c?this.insertRow(b,k):this.d[b]=k},Matrix3d.prototype.insertRowBlank=function(a){this.insertRow(a,this.getRowBlank())},Matrix3d.prototype.insertRow=function(a,b){this.d.splice(a,0,b.slice()),this._rs.push([]),this.r++},Matrix3d.prototype.distributeRowByCount=function(a,b,c){var d,e,f;for(c=c||1/0,a!==b&&this.concatRows(a,b),f=0;f<this.c;f++)this.d[b][f].length>c&&(d=this.d[b][f].length,e=d-c,void 0!==this.d[b][f+1]?this.d[b][f+1]=this.d[b][f].slice(d-e,d).concat(nxt):this.d[b][f+1-this.c]=this.d[b][f].slice(d-e,d).concat(nxt),this.d[b][f]=this.d[b][f].slice(0,d-e))},Matrix3d.prototype.distributeRowByIndex=function(a,b,c,d){var e,f;for(a!==b&&this.concatRows(a,b),f=0;f<this.c;f++)e=d(this.d[b][f],this,f,b),e>=this.d[b][f].length||void 0===e||null===e||e<0&&-e>this.d[b][f].length||(e<0&&-e<this.d[b][f].length&&(e=this.d[b][f].length-e),void 0!==this.d[b][f+1]?this.d[b][f+1]=this.d[b][f].slice(e-1).concat(this.d[b][f+1]):this.d[b][f+1-this.c]=this.d[b][f].slice(e-1).concat(this.d[b][f+1-this.c]),this.d[b][f]=this.d[b][f].slice(0,e-1))},Matrix3d.prototype.distributeRowByCounter=function(a,b,c,d){a!==b&&this.concatRows(a,b);var e,f,g,h,i;for(h=0;h<this.c;h++){for(e=0,i=0;i<this.d[b][h].length;i++)e+=d(this.d[b][h][i],this,i,h,b,!0);if(e>this.m){for(f=0,g=0,i=0;i<this.d[b][h].length&&(f+=d(this.d[b][h][i],this,g,h,b,!1),g++,!(f>=this.m));i++);void 0!==this.d[b][h+1]?this.d[b][h+1]=this.d[b][h].slice(g-1).concat(this.d[b][h+1]):this.d[b][h+1-this.c]=this.d[b][h].slice(g-1).concat(this.d[b][h+1-this.c]),this.d[b][h]=this.d[b][h].slice(0,g-1)}}},Matrix3d.prototype.distributeRowByCallBack=function(a,b,c,d){a!==b&&this.concatRows(a,b);var e,f;for(f=0;f<this.c;f++){for(e=[];d(this.d[b][f],this,f,b);)e.push(this.d[b][f].pop());void 0!==this.d[b][f+1]?this.d[b][f+1]=e.concat(this.d[b][f+1]):this.d[b][f+1-this.c]=e.concat(this.d[b][f+1-this.c])}},Matrix3d.prototype.restore=function(){for(var a=0;a<this.r;a++)this.shiftRow(a,this._rs.reduce(function(a,b){return a+b}))},Matrix3d.prototype.concatRows=function(a,b,c){var d,e,f,g,h;for(g=0;g<this.c;g++)for(d=this.d[a][g],e=this.d[b][g],f=c?d.length:d.length-e.length,h=d.length-f;h<d.length;h++)e.push(d[h])},Matrix3d.prototype.mergeRows=function(a,b){var c,d;if("number"==typeof a)this.concatRows(a,b,!0);else for(c=0;c<this.c;c++)for(d=0;d<a[c].length;d++)this.d[b][c].push(a[c][d])},Matrix3d.prototype.merge=function(a){this.m=this.m?this.m:a.m?a.m:this.m,this.r=this.r?this.r:a.r?a.r:this.r,this.c=this.c?this.c:a.c?a.c:this.c,this.rs=[];var b,c,d,e,f;for(this.d.length?(b=this,c=a):a.d.length?(b=a,c=this):console.warn("empty merge"),d=0;d<c.d.length;d++)for(e=0;e<c.d[d].length;e++)for(f=0;f<c.d[d][e].length;f++)b.d[d][e].push(c.d[d][e][f]);return b},Matrix3d.prototype.serialize=function(a){return{class:"Matrix3d",data:{d:null,m:this.m,r:this.r,c:this.c,_rs:this._rs}}};